- name: Obtener roles de usuario
  uri:
    url: "{{ zabbix_api_url }}"
    method: POST
    body_format: json
    body:
      jsonrpc: "2.0"
      method: "role.get"
      params:
        output: ["roleid", "name"]
      auth: "{{ auth_response.json.result }}"
      id: 1
    headers:
      Content-Type: "application/json-rpc"
    return_content: yes
    validate_certs: no
  register: role_result

- name: Buscar ID del rol por nombre
  set_fact:
    role_id: "{{ (role_result.json.result | selectattr('name', 'equalto', role_name) | list)[0].roleid }}"
  vars:
    role_name: "{{ role_name }}"
  when: role_result.json.result | selectattr('name', 'equalto', role_name) | list | count > 0

- fail:
    msg: El rol "{{ role_name }}" no fue encontrado en Zabbix.
  when: role_id is undefined
